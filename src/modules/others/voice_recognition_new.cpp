#include "voice_recognition.h" 
`n#include <Preferences.h>`n#include <SD.h>`n#include <FS.h>`n`n// External references`nextern AIAttackLearner aiLearner;`n`n// Voice recognition state`nstatic VoiceRecState voice_state = VOICE_IDLE;`nstatic Preferences voice_prefs;`nstatic String personalized_name = "";`nstatic bool voice_personalized = false;`nstatic float voice_threshold = 0.3f;`nstatic String custom_wake_phrases[5];`nstatic int custom_wake_count = 0;`n`nbool init_voice_recognition() {`n    voice_prefs.begin("voice_rec", false);`n    personalized_name = voice_prefs.getString("user_name", "");`n    voice_personalized = voice_prefs.getBool("personalized", false);`n    voice_threshold = voice_prefs.getFloat("threshold", 0.3f);`n    `n    // Load custom wake phrases`n    custom_wake_count = voice_prefs.getInt("wake_count", 0);`n    for(int i = 0; i < custom_wake_count && i < 5; i++) {`n        custom_wake_phrases[i] = voice_prefs.getString(String("wake_") + i, "");`n    }`n    `n    voice_state = VOICE_IDLE;`n    return true;`n}`n`nvoid start_voice_listening() {`n    if (voice_state == VOICE_IDLE) {`n        voice_state = VOICE_LISTENING;`n        speak_with_emotion("Estou ouvindo...", EMOTION_NEUTRAL);`n    }`n}`n`nvoid stop_voice_listening() {`n    voice_state = VOICE_IDLE;`n}`n`nVoiceRecState get_voice_rec_state() {`n    return voice_state;`n}
`nNaturalCommand process_voice_input() {`n    NaturalCommand result = {"", CMD_WAKE_UP, 0.0f, {"", "", ""}};`n    `n    if (voice_state != VOICE_LISTENING) return result;`n    `n    voice_state = VOICE_PROCESSING;`n    `n    // Simple keyword-based recognition (placeholder for real ML)`n    // In a real implementation, this would use Edge Impulse or similar`n    `n    // Simulate voice input (in real implementation, this would come from ADC)`n    String simulated_input = "atacar wifi"; // This would be actual speech-to-text`n    `n    result.command_text = simulated_input;`n    result.confidence = 0.85f; // Simulated confidence`n    `n    // Parse natural language commands`n    if (simulated_input.indexOf("atacar") >= 0 || simulated_input.indexOf("ataque") >= 0) {`n        if (simulated_input.indexOf("wifi") >= 0 || simulated_input.indexOf("rede") >= 0) {`n            result.action = CMD_ATTACK_DEAUTH;`n            result.parameters[0] = "wifi";`n        } else if (simulated_input.indexOf("wps") >= 0) {`n            result.action = CMD_ATTACK_WPS;`n            result.parameters[0] = "wps";`n        } else if (simulated_input.indexOf("nfc") >= 0) {`n            result.action = CMD_ATTACK_NFC;`n            result.parameters[0] = "nfc";`n        }`n    } else if (simulated_input.indexOf("status") >= 0 || simulated_input.indexOf("como vai") >= 0) {`n        result.action = CMD_SYSTEM_STATUS;`n    } else if (simulated_input.indexOf("parar") >= 0 || simulated_input.indexOf("stop") >= 0) {`n        result.action = CMD_STOP_ATTACK;`n    }`n    `n    voice_state = result.action != CMD_WAKE_UP ? VOICE_RECOGNIZED : VOICE_ERROR;`n    return result;`n}`n`nbool init_voice_training() {`n    return true;`n}`n`nbool start_voice_training(String user_name) {`n    personalized_name = user_name;`n    voice_prefs.putString("user_name", user_name);`n    speak_with_emotion("Olá " + user_name + ", vamos personalizar sua voz. Diga algumas frases.", EMOTION_EXCITED);`n    return true;`n}`n`nbool add_voice_sample(String phrase) {`n    // In real implementation, would capture voice sample`n    speak_with_emotion("Amostra recebida: " + phrase, EMOTION_SUCCESS);`n    return true;`n}`n`nbool finish_voice_training() {`n    voice_personalized = true;`n    voice_prefs.putBool("personalized", true);`n    speak_with_emotion("Voz personalizada com sucesso, " + personalized_name + "!", EMOTION_SUCCESS);`n    return true;`n}`n`nbool is_voice_personalized() {`n    return voice_personalized;`n}`n`nString get_personalized_voice_name() {`n    return personalized_name;`n}
