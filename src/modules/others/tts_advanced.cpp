`n#include "tts_advanced.h"`n#include "core/ai_attack_learner.h"`n#include <Preferences.h>`n`n// External references`nextern AIAttackLearner aiLearner;`nextern bool attack_running;`nextern unsigned long last_speech_time;`nextern bool speech_pending;`n`n// Settings`nstatic bool emotional_tts_enabled = true;`nstatic bool wake_word_enabled = true;`n`n// Voice analytics`nstatic uint32_t total_voice_interactions = 0;`nstatic uint32_t successful_voice_interactions = 0;`nstatic Preferences voice_prefs;`n`n// Wake word detection using gesture sensor + button`nbool init_wake_word_detection() {`n    // Uses existing PAJ7620U2 gesture sensor and button`n    voice_prefs.begin("tts_advanced", false);`n    wake_word_enabled = voice_prefs.getBool("wake_word", true);`n    return true;`n}`n`nbool is_wake_word_detected() {`n    if (!wake_word_enabled) return false;`n    `n    // Check for wake gestures (implemented in gesture_wake.cpp)`n    // For now, use button press as wake word`n    // In future: integrate with actual voice recognition`n    return false; // Placeholder - would check gesture/button`n}`n`nvoid process_wake_word() {`n    if (!wake_word_enabled) return;`n    `n    // Wake from deep sleep if sleeping`n    // Play wake sound`n    speak_with_emotion("Sistema acordado. Pronto para comandos.", EMOTION_EXCITED);`n    `n    // Update timestamps`n    extern unsigned long last_speech_time;`n    last_speech_time = millis();`n}`n`n// Emotional TTS implementation`nvoid speak_with_emotion(const char* message, EmotionState emotion) {`n    if (!emotional_tts_enabled) {`n        think_and_speak(message);`n        return;`n    }`n    `n    // Modify voice parameters based on emotion`n    // Since we use ESP8266SAM, we can adjust pitch/speed`n    String emotional_message = String(message);`n    `n    switch (emotion) {`n        case EMOTION_SUCCESS:`n            // Higher pitch, enthusiastic`n            emotional_message = "Excelente! " + emotional_message;`n            break;`n        case EMOTION_FAILURE:`n            // Lower pitch, slower`n            emotional_message = "Que pena... " + emotional_message;`n            break;`n        case EMOTION_ALERT:`n            // Fast, urgent`n            emotional_message = "Atenção! " + emotional_message;`n            break;`n        case EMOTION_EXCITED:`n            // Very high pitch, fast`n            emotional_message = "Incrível! " + emotional_message;`n            break;`n        case EMOTION_NEUTRAL:`n        default:`n            // Normal voice`n            break;`n    }`n    `n    think_and_speak(emotional_message);`n    log_voice_interaction("emotional_speech", true);`n}`n`nvoid speak_with_emotion(String message, EmotionState emotion) {`n    speak_with_emotion(message.c_str(), emotion);`n}`n`n// Voice commands (gesture/button based for now)`nbool init_voice_commands() {`n    emotional_tts_enabled = voice_prefs.getBool("emotional", true);`n    return true;`n}`n`nVoiceCommand detect_voice_command() {`n    // Placeholder - would integrate with voice recognition`n    // For now, return NONE`n    return CMD_WAKE_UP; // Default`n}`n`nvoid execute_voice_command(VoiceCommand cmd) {`n    switch (cmd) {`n        case CMD_ATTACK_DEAUTH:`n            aiLearner.execute_attack_with_voice(ATTACK_DEAUTH);`n            log_voice_interaction("cmd_deauth", true);`n            break;`n        case CMD_ATTACK_WPS:`n            aiLearner.execute_attack_with_voice(ATTACK_EVIL_TWIN);`n            log_voice_interaction("cmd_wps", true);`n            break;`n        case CMD_ATTACK_NFC:`n            aiLearner.execute_attack_with_voice(ATTACK_FAULT_INJECT);`n            log_voice_interaction("cmd_nfc", true);`n            break;`n        case CMD_SYSTEM_STATUS:`n            speak_with_emotion("Sistema funcionando perfeitamente.", EMOTION_SUCCESS);`n            log_voice_interaction("cmd_status", true);`n            break;`n        case CMD_STOP_ATTACK:`n            attack_running = false;`n            speak_with_emotion("Ataque interrompido.", EMOTION_NEUTRAL);`n            log_voice_interaction("cmd_stop", true);`n            break;`n        case CMD_WAKE_UP:`n            process_wake_word();`n            log_voice_interaction("cmd_wake", true);`n            break;`n    }`n}`n`n// Voice analytics`nvoid init_voice_analytics() {`n    total_voice_interactions = voice_prefs.getUInt("total_int", 0);`n    successful_voice_interactions = voice_prefs.getUInt("success_int", 0);`n}`n`nvoid log_voice_interaction(const char* action, bool success) {`n    total_voice_interactions++;`n    if (success) successful_voice_interactions++;`n    `n    // Save to preferences periodically`n    if (total_voice_interactions % 10 == 0) {`n        voice_prefs.putUInt("total_int", total_voice_interactions);`n        voice_prefs.putUInt("success_int", successful_voice_interactions);`n    }`n}`n`nvoid get_voice_stats(uint32_t* total, uint32_t* successful, float* rate) {`n    if (total) *total = total_voice_interactions;`n    if (successful) *successful = successful_voice_interactions;`n    if (rate) {`n        *rate = total_voice_interactions > 0 ? `n            (float)successful_voice_interactions / total_voice_interactions * 100.0f : 0.0f;`n    }`n}`n`n// Settings`nbool is_emotional_tts_enabled() {`n    return emotional_tts_enabled;`n}`n`nvoid set_emotional_tts_enabled(bool enabled) {`n    emotional_tts_enabled = enabled;`n    voice_prefs.putBool("emotional", enabled);`n}`n`nbool is_wake_word_enabled() {`n    return wake_word_enabled;`n}`n`nvoid set_wake_word_enabled(bool enabled) {`n    wake_word_enabled = enabled;`n    voice_prefs.putBool("wake_word", enabled);`n}
